<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Complaint Reports</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="top-nav">
    <div class="nav-title">Complaint Reports</div>
    <div class="menu-btn" onclick="toggleMenu()">&#8942;</div>
</nav>

<div id="sideMenu" class="side-menu">
    <a href="/admin">ðŸ“Š Dashboard</a>
    <a href="/admin/users">ðŸ‘¥ Registered Users</a>
    <a href="/admin/logs">ðŸ“œ Login Logs</a>
    <a href="/admin/reports">ðŸ“ˆ Reports</a>
    <a href="/logout" class="logout">ðŸšª Logout</a>
</div>

<script>
function toggleMenu() {
    const menu = document.getElementById("sideMenu");
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}
</script>

<div id="sideMenu" class="side-menu">
    <a href="/admin">ðŸ“Š Dashboard</a>
    <a href="/admin/users">ðŸ‘¥ Registered Users</a>
    <a href="/admin/logs">ðŸ“œ Login Logs</a>
    <a href="/admin/reports">ðŸ“ˆ Reports</a>
    <a href="/logout" class="logout">ðŸšª Logout</a>
</div>

<!-- Data holder (NO JS JINJA MIXING) -->
<div id="reportData"
     data-pending="{{ pending }}"
     data-received="{{ received }}"
     data-verified="{{ verified }}"
     data-resolved="{{ resolved }}">
</div>

<div class="login-container" style="max-width:700px;">
    <h2>Complaint Statistics</h2>

    <p><strong>Pending:</strong> {{ pending }}</p>
    <p><strong>Received:</strong> {{ received }}</p>
    <p><strong>Verified:</strong> {{ verified }}</p>
    <p><strong>Resolved:</strong> {{ resolved }}</p>

    <canvas id="complaintChart" height="200"></canvas>
</div>

<script>
    // Read values safely from HTML
    const dataDiv = document.getElementById("reportData");

    const pending = parseInt(dataDiv.dataset.pending);
    const received = parseInt(dataDiv.dataset.received);
    const verified = parseInt(dataDiv.dataset.verified);
    const resolved = parseInt(dataDiv.dataset.resolved);

    const ctx = document.getElementById("complaintChart").getContext("2d");

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Pending", "Received", "Verified", "Resolved"],
            datasets: [{
                label: "Complaints",
                data: [pending, received, verified, resolved],
                backgroundColor: [
                    "#ffc107",
                    "#03a9f4",
                    "#673ab7",
                    "#4caf50"
                ]
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { precision: 0 }
                }
            }
        }
    });
</script>
<script>
    function toggleMenu() {
        const menu = document.getElementById("sideMenu");
        // Toggle display between 'flex' and 'none'
        if (menu.style.display === "flex") {
            menu.style.display = "none";
        } else {
            menu.style.display = "flex";
        }
    }

    // Close the menu if the user clicks anywhere outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.menu-btn')) {
            const menu = document.getElementById("sideMenu");
            if (menu && menu.style.display === "flex") {
                menu.style.display = "none";
            }
        }
    }
</script>

</body>
</html>
